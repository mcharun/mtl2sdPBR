# mtl2sdPBR
# まえがき
この変換ツールはまだα版です。β版ですらなく、自分用に作ったものをなんとなく公開している程度のものです。
不具合やバグなどが多分に含まれる可能性があります。また、環境によってはうまく動作しない可能性もあります。
MITライセンスなので使用は自由ですが、このツールの使用等で発生した損害については一切の責任を負いかねます。
ファイルの階層構造などについての最低限の理解がある前提で説明を行っています。説明が難しいと感じるようであれば
本ツールを使わない方が良いでしょう。…最も、こんなニッチなツールを使う方は充分にPCに詳しい方だと思いますが…

# どんなツールなの？
大雑把に言えば、「MMD以外の3DCGソフトのリアルな質感を簡単にMMDに持ってくることができる」ツールです。
MMD用じゃないアクセサリとかの質感をそのままMMDに持ってくることができます。

…もう少し詳しく解説します。現在、3DCG界隈ではPBR…物理ベースレンダリングを用いることが非常に多いです。
PBR対応とすることで、簡単にリアルな質感を得ることができるからです。しかし、MMDは古いソフトなのでPBRに対応しておりません。
なので、そのままだと他ソフトのようなリアルな質感を得ることが難しいです。しかし、サンドマン氏の作成したsdPBRを用いれば
他のソフトと同じように、PBRに対応することが可能となります。

さて、MMD以外の3Dソフトで良く使われる3Dデータ形式に、objファイルというのがあります。objファイルは
マテリアル(質感)を設定するmtlファイルとセットで使います。
本ツールは、このmtlファイルを読み込んで、sdPBR対応のマテリアル(fxファイル)に変換するツールです。
これにより、他ソフトの質感を簡単にMMDに持ってくることが可能です。

例えば、objファイルとpmxファイルの両方を配布するモデラーさんだったり、購入したMMD以外のソフト用の小物をMMDで使いたい人には、とても便利だと思います。(ただし後者の場合は小物の規約に注意を)

# つかいかた
1　Pythonをインストールします。3.9x以降のバージョンのPythonが既にインストールされていれば、省略して構いません。

2　mtl2sdPBR.pyを実行します。

3　mtl file path:に変換元のmtlファイルのパス、fx file path:にfxファイルを作りたいフォルダのパスを入れます。mtl2sdPBR.pyからの相対的なパスか絶対パスを入力してください。前者は”ファイル名.mtl”、後者は"フォルダ位置/"のように入力してください(.mtlと/を忘れずに！)
    
4　endと表示された場合、変換が成功しています。Enterを押すとプログラムが終了しています。

5　3で指定したフォルダにマテリアルごとのfxファイルが作られます。sdPBR470/material/任意のフォルダの中にfxファイルを入れて、MMEに読み込みましょう。

# 注意
・sdPBR470以外での動作は確認していません。古いバージョンだとファイル形式が違うので、最新版を使いましょう。

・sdPBRのマテリアルは、sdPBR470/material/任意のフォルダの階層になければうまく動作しません。そのため、本ツールはその階層にfxファイルを設置することを想定して作られています。それ以外の場所にfxファイルを置くと多分エラーが出ます。

・テクスチャを用いる場合、mtlファイル→テクスチャと、変換先のfxファイル→テクスチャの位置関係は同じになるようにしてください。普通はmtlファイルと同じ階層にtexturesみたいなフォルダを作るので、そのフォルダをそのままfxファイルと同じ場所に置くと良いでしょう。

・テクスチャパックには対応しておりません。というか配布されているPBRテクスチャを使うのであればsdPBR付属のmaterial importerを使った方が遥かにスマートです。

・mtlファイルの形式には若干のブレがあります。本ツールはBlenderで出力したmtlファイルの変換をベースとしているため、それ以外のソフトから出力されたmtlファイルは変換できない可能性があります。まあ普通は大丈夫だと思いますが。

・mtlとsdPBRでは、サポートしているパラメーターに若干の差異があります。全てのパラメーターを変換出来ないことについては仕様なのでご容赦下さい…

・NPR(物理ベースでないレンダリング)用のパラメーターの一部は変換していません。アンビエント色とかが該当します。そういった古い形式のmtlファイルなら別にsdPBRを使わなくてもPMXeでポチポチするだけで良いので…

・テクスチャマップのズレや繰り返し、混合については対応していません。正直あまり使うイメージがありませんが、mtlでもsdPBRでもどっちでもサポートされている機能なので、余力があったら実装するかもしれません。ただしノーマルマップ強度については対応しています。

・スペキュラー強度は屈折率から変換して指定するようになっています。これは物理的であるものの、意図とは異なる表現になってしまう可能性もあります。その場合は、 fxファイルのm.specular=IORtoSpecular(X);の部分をm.specular=スペキュラー強度;と書き換えましょう。普通ならスペキュラー強度は0.5くらいにしておけば問題無いですが凸凹が激しい場合はもう少し小さくしてもよいかもしれません。

# 変換できるパラメーターの対応関係
一般名:mtlでの名称/sdPBRでの名称 となっております

## RGBカラーで指定するパラメーター
	ベースカラー:Kd/baseColor
	放射色:Ke/emissiveColor
## スカラー値で指定するパラメーター
	屈折率(スペキュラー強度):Ni/specular=IORtoSpecular(X)
	粗さ:Pr/roughness
	メタリック:Pm/metalic
	sheen:Ps/sheen
	クリアコート:Pc/clearcoat
	クリアコートの滑らかさ:Pcr/clearcoatGloss
	異方性:aniso/anisotropic
	異方性の回転:anisor/anisoAngleX
	ノーマルマップ強度:map_Bump -bm/normalScale 
## テクスチャ
	ディフューズ色テクスチャ:map_Kd/BASECOLOR
	ラフネスマップ:map_Pr/ROUGHNESS
	メタリックマップ:map_Pm/METALLIC
	透過度マップ:map_d/MASK
	ノーマルマップ:map_Bump/NORMAL
	放射光マップ:map_Ke/EMISSIVE

# ライセンス
Copyright (c) 2024 mcharun
Released under the MIT license
https://opensource.org/license/mit

# さいごに
MITライセンスなのでほぼ自由に使えますが、このツールを活用した作品をニコニコに投稿した際には、ぜひ配布動画(https://www.nicovideo.jp/watch/sm43905931 )の親作品登録をお願いします。sdPBR開発者のサンドマン氏に、大変感謝します。

2024/08/05 ver 0.1 
